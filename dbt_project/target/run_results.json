{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.7", "generated_at": "2025-12-14T08:42:17.522645Z", "invocation_id": "788665af-dfe5-46bd-bc85-df510efe689b", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-14T08:42:03.603739Z", "completed_at": "2025-12-14T08:42:03.625428Z"}, {"name": "execute", "started_at": "2025-12-14T08:42:03.626318Z", "completed_at": "2025-12-14T08:42:05.581348Z"}], "thread_id": "Thread-1", "execution_time": 1.9792935848236084, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "pubg-analytics-2025", "job_id": "57f21ba8-c125-425b-8351-18c044f1d103", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pubg_analytics.stg_match_summary", "compiled": true, "compiled_code": "WITH json_data AS (\n    SELECT \n        match_id,\n        player_name AS reference_player_name,\n        season_id,\n        JSON_EXTRACT_SCALAR(raw, '$.data.attributes.mapName') as map_name,\n        JSON_EXTRACT_SCALAR(raw, '$.data.attributes.gameMode') as game_mode,\n        TIMESTAMP(JSON_EXTRACT_SCALAR(raw, '$.data.attributes.createdAt')) as match_start_time,\n        SAFE_CAST(JSON_EXTRACT_SCALAR(raw, '$.data.attributes.duration') AS INT64) as match_duration_sec,\n        entry\n    FROM `pubg-analytics-2025`.`pubg_raw`.`matches`,\n    UNNEST(JSON_EXTRACT_ARRAY(raw, '$.included')) as entry\n)\n\nSELECT\n    match_id,\n    season_id,\n    reference_player_name,\n    map_name,\n    game_mode,\n    match_start_time,\n    match_duration_sec,\n    \n    -- Player Identifiers\n    JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.playerId') as account_id,\n    JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.name') as player_name,\n    \n    -- Core Performance Metrics\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.winPlace') AS INT64) as win_place,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.kills') AS INT64) as kills,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.damageDealt') AS FLOAT64) as damage_dealt,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.headshotKills') AS INT64) as headshot_kills,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.assists') AS INT64) as assists,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.DBNOs') AS INT64) as dbnos, -- Knocked downs\n    \n    -- Survival & Travel\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.timeSurvived') AS FLOAT64) as time_survived_sec,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.walkDistance') AS FLOAT64) + \n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.rideDistance') AS FLOAT64) + \n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.swimDistance') AS FLOAT64) as total_distance_meters,\n    \n    -- Economy/Looting\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.weaponsAcquired') AS INT64) as weapons_looted,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.heals') AS INT64) + \n    SAFE_CAST(JSON_EXTRACT_SCALAR(entry, '$.attributes.stats.boosts') AS INT64) as total_healing_items_used\n\nFROM json_data\nWHERE JSON_EXTRACT_SCALAR(entry, '$.type') = 'participant'", "relation_name": "`pubg-analytics-2025`.`pubg_marts`.`stg_match_summary`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-14T08:42:05.591153Z", "completed_at": "2025-12-14T08:42:05.601441Z"}, {"name": "execute", "started_at": "2025-12-14T08:42:05.602394Z", "completed_at": "2025-12-14T08:42:07.989331Z"}], "thread_id": "Thread-1", "execution_time": 2.400956153869629, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "pubg-analytics-2025", "job_id": "2f514f9a-cae9-47fa-9f14-37bae19d0b84", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pubg_analytics.stg_season_stats", "compiled": true, "compiled_code": "WITH raw_stats AS (\n    SELECT \n        player_name,\n        season_id,\n        raw as json_blob,\n        ingested_at\n    FROM `pubg-analytics-2025`.`pubg_raw`.`player_season_stats`\n)\n\nSELECT \n    player_name,\n    season_id,\n    \n    -- Extract SQUAD-FPP Stats (The Competitive Standard)\n    -- Path: raw -> data -> attributes -> gameModeStats -> squad-fpp\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.roundsPlayed') AS INT64) as rounds_played,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.wins') AS INT64) as wins,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.top10s') AS INT64) as top_10s,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.kills') AS INT64) as kills,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.damageDealt') AS FLOAT64) as damage_dealt,\n    SAFE_CAST(JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.assists') AS INT64) as assists,\n    \n    -- Keep the timestamp to know how fresh the data is\n    ingested_at\n\nFROM raw_stats\n-- Only keep rows where we successfully extracted rounds (removes empty seasons)\nWHERE JSON_EXTRACT_SCALAR(json_blob, '$.data.attributes.gameModeStats.squad-fpp.roundsPlayed') IS NOT NULL", "relation_name": "`pubg-analytics-2025`.`pubg_marts`.`stg_season_stats`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-14T08:42:08.000499Z", "completed_at": "2025-12-14T08:42:08.016705Z"}, {"name": "execute", "started_at": "2025-12-14T08:42:08.018820Z", "completed_at": "2025-12-14T08:42:09.728927Z"}], "thread_id": "Thread-1", "execution_time": 1.7312939167022705, "adapter_response": {"_message": "CREATE VIEW (0 processed)", "code": "CREATE VIEW", "bytes_processed": 0, "bytes_billed": 0, "location": "US", "project_id": "pubg-analytics-2025", "job_id": "bc28c5f8-bf90-4ca4-bbbc-963199ba0212", "slot_ms": 0}, "message": "CREATE VIEW (0 processed)", "failures": null, "unique_id": "model.pubg_analytics.stg_telemetry", "compiled": true, "compiled_code": "WITH raw_telemetry AS (\n    SELECT \n        match_id,\n        season_id,\n        raw as json_blob\n    FROM `pubg-analytics-2025`.`pubg_raw`.`telemetry`\n)\n\nSELECT \n    t.match_id,\n    t.season_id,\n    \n    -- Extract Event Type (Clean \"LogPlayerKillV2\" to just \"LogPlayerKill\")\n    JSON_EXTRACT_SCALAR(x, '$._T') as event_type,\n    \n    -- Timestamp of the event\n    TIMESTAMP(JSON_EXTRACT_SCALAR(x, '$._D')) as event_timestamp,\n\n    -- KILLER / ATTACKER INFO\n    -- We use COALESCE because \"Damage\" events use 'attacker' and \"Kill\" events use 'killer'\n    COALESCE(\n        JSON_EXTRACT_SCALAR(x, '$.killer.name'), \n        JSON_EXTRACT_SCALAR(x, '$.attacker.name'), \n        'Environment' \n    ) as player_name,\n\n    -- VICTIM INFO\n    JSON_EXTRACT_SCALAR(x, '$.victim.name') as victim_name,\n\n    -- COMBAT STATS\n    SAFE_CAST(JSON_EXTRACT_SCALAR(x, '$.damage') AS FLOAT64) as damage_dealt,\n    JSON_EXTRACT_SCALAR(x, '$.damageTypeCategory') as weapon_category,\n    JSON_EXTRACT_SCALAR(x, '$.damageCauserName') as weapon_name\n\nFROM raw_telemetry t,\nUNNEST(JSON_EXTRACT_ARRAY(t.json_blob)) as x\nWHERE \n    -- Filter for only the events we need for the dashboard\n    JSON_EXTRACT_SCALAR(x, '$._T') LIKE 'LogPlayerKill%' \n    OR \n    JSON_EXTRACT_SCALAR(x, '$._T') = 'LogPlayerTakeDamage'", "relation_name": "`pubg-analytics-2025`.`pubg_marts`.`stg_telemetry`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-14T08:42:09.737037Z", "completed_at": "2025-12-14T08:42:09.759883Z"}, {"name": "execute", "started_at": "2025-12-14T08:42:09.761375Z", "completed_at": "2025-12-14T08:42:13.339330Z"}], "thread_id": "Thread-1", "execution_time": 3.604055643081665, "adapter_response": {"_message": "CREATE TABLE (127.0 rows, 43.2 KiB processed)", "code": "CREATE TABLE", "rows_affected": 127, "bytes_processed": 44200, "bytes_billed": 10485760, "location": "US", "project_id": "pubg-analytics-2025", "job_id": "7a28a812-a568-4331-96aa-c10b655d790f", "slot_ms": 2891}, "message": "CREATE TABLE (127.0 rows, 43.2 KiB processed)", "failures": null, "unique_id": "model.pubg_analytics.fct_latest_match_player_stats", "compiled": true, "compiled_code": "SELECT \n    s.season_id,\n    s.match_id,\n    s.map_name,\n    s.reference_player_name,\n    s.game_mode,\n    s.player_name,\n    \n    -- Rank & Survival\n    s.win_place,\n    CASE WHEN s.win_place = 1 THEN 'Winner' \n         WHEN s.win_place <= 10 THEN 'Top 10' \n         ELSE 'Eliminated' END as placement_tier,\n    ROUND(s.time_survived_sec / 60, 2) as minutes_survived,\n    \n    -- Combat Efficiency\n    s.kills,\n    s.assists,\n    s.damage_dealt,\n    \n    -- Calculated Metrics\n    CASE WHEN s.win_place = 1 THEN s.kills -- You don't die if you win\n         ELSE s.kills / 1 END as kd_ratio, \n         \n    ROUND(SAFE_DIVIDE(s.damage_dealt, s.kills), 0) as damage_per_kill, -- High number = Kill Stealer or Poker\n    ROUND(SAFE_DIVIDE(s.headshot_kills, s.kills), 2) * 100 as headshot_percentage,\n    \n    -- Playstyle Indicators\n    s.total_distance_meters as mobility_score,\n    s.total_healing_items_used as survival_utility_usage\n\nFROM `pubg-analytics-2025`.`pubg_marts`.`stg_match_summary` s", "relation_name": "`pubg-analytics-2025`.`pubg_marts`.`fct_latest_match_player_stats`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-14T08:42:13.347266Z", "completed_at": "2025-12-14T08:42:13.359527Z"}, {"name": "execute", "started_at": "2025-12-14T08:42:13.360778Z", "completed_at": "2025-12-14T08:42:17.513096Z"}], "thread_id": "Thread-1", "execution_time": 4.167538404464722, "adapter_response": {"_message": "CREATE TABLE (4.0 rows, 358.0 Bytes processed)", "code": "CREATE TABLE", "rows_affected": 4, "bytes_processed": 358, "bytes_billed": 10485760, "location": "US", "project_id": "pubg-analytics-2025", "job_id": "4806bab3-2f30-4411-ab62-643089d1f79b", "slot_ms": 14950}, "message": "CREATE TABLE (4.0 rows, 358.0 Bytes processed)", "failures": null, "unique_id": "model.pubg_analytics.fct_season_stats", "compiled": true, "compiled_code": "WITH staging AS (\n    SELECT * FROM `pubg-analytics-2025`.`pubg_marts`.`stg_season_stats`\n    -- Get the most recent record for each player/season combo (deduplication)\n    QUALIFY ROW_NUMBER() OVER (PARTITION BY player_name, season_id ORDER BY ingested_at DESC) = 1\n)\n\nSELECT \n    player_name,\n    season_id,\n    \n    -- Core Counts\n    rounds_played,\n    wins,\n    top_10s,\n    kills,\n    \n    -- Calculated KPIs\n    \n    -- 1. K/D Ratio: Kills / Deaths\n    -- In PUBG, Deaths = Rounds Played - Wins (You don't die if you win)\n    ROUND(\n        kills / NULLIF((rounds_played - wins), 0), \n        2\n    ) as kd_ratio,\n    \n    -- 2. Average Damage per Round (ADR)\n    ROUND(damage_dealt / NULLIF(rounds_played, 0), 0) as avg_damage,\n    \n    -- 3. Win Rate %\n    ROUND((wins / NULLIF(rounds_played, 0)) * 100, 1) as win_rate_pct,\n    \n    -- 4. Top 10 Rate %\n    ROUND((top_10s / NULLIF(rounds_played, 0)) * 100, 1) as top10_rate_pct\n\nFROM staging", "relation_name": "`pubg-analytics-2025`.`pubg_marts`.`fct_season_stats`"}], "elapsed_time": 15.60238265991211, "args": {"warn_error_options": {"include": [], "exclude": []}, "log_level": "info", "which": "run", "log_path": "/opt/airflow/dbt_project/logs", "vars": {}, "log_format_file": "debug", "log_format": "default", "write_json": true, "cache_selected_only": false, "exclude": [], "require_resource_names_without_spaces": false, "select": [], "enable_legacy_logger": false, "partial_parse": true, "show_resource_report": false, "source_freshness_run_project_hooks": false, "project_dir": "/opt/airflow/dbt_project", "partial_parse_file_diff": true, "print": true, "log_level_file": "debug", "favor_state": false, "use_colors_file": true, "send_anonymous_usage_stats": true, "invocation_command": "dbt run --project-dir /opt/airflow/dbt_project --profiles-dir /opt/airflow/dbt_project", "quiet": false, "indirect_selection": "eager", "require_explicit_package_overrides_for_builtin_materializations": true, "empty": false, "printer_width": 80, "introspect": true, "static_parser": true, "strict_mode": false, "defer": false, "log_file_max_bytes": 10485760, "populate_cache": true, "macro_debugging": false, "use_colors": true, "version_check": true, "profiles_dir": "/opt/airflow/dbt_project"}}